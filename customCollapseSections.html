<script>
	
/*
	 
	
○ ｐ ｐヰ○ ｐヰ ○ю ヰｐヰ
  
Con este c贸digo, puedes agregar f谩cilmente elementos colapsables en WordPress.




○ヰ⑻   ｐ:


	1. ○ю ю: 
	Elige el elemento de WordPress que activar谩 la apertura o cierre de la secci贸n colapsable: 

		1.1. Selecci贸nalo (desde el editor de WordPress) y abre la pesta帽a de 火别.
		1.2. Ve a la secci贸n de 筐娥拣.
		1.3. Elige un "nombre" para la secci贸n colapsable, como por ejemplo "saber_mas", y escribe el atributo "open-collapse-section" con el "nombre" de la secci贸n colapsable como valor, por ejemplo:
		拣金拆-梆拣桂桂金-拆梆娥拣|拆_吼


	○ю ｐ: 
	Elige el elemento de WordPress que se colapsar谩 (abrir/cerrar):

		2.1. Selecci贸nalo (desde el editor de WordPress) y abre la pesta帽a de 火别.
		2.2. Ve a la secci贸n de 筐娥拣.
		2.3. Agrega el atributo "collapse-section-name" con el valor de la secci贸n colapsable (el que elegiste cuando agregaste el atributo en el elemento "activador"), por ejemplo:
		梆拣桂桂金-拆梆娥拣-火吼|拆_吼






ｐ○ ○ (金梆娥拣火桂拆):


	拣别娥仇娥梆 拆 娥拆吼金 别 筐火娥梆娥拣:
	Para cambiar el tiempo de transici贸n, agrega el atributo collapse-section-transition al elemento colapsado. El valor del atributo debe ser el tiempo que deseas para la duraci贸n de la transici贸n, en milisegundos. Por ejemplo, "1000" para 1000 milisegundos (equivalente a un segundo).


	筐娥/梆拆筐筐/拣答答桂  拆桂拆吼拆火 梆拣桂桂金桂 梆拣 :
	En el objeto de la ventana (window) se ha agregado customCollapseSections. Puedes acceder a sus propiedades open, close y toggle para gestionar los colapsables con JavaScript.


	梆梆拆别拆  拣佛拆 别 梆拣火仇娥答筐梆娥拣:
	Desde window.customCollapseSections.config, puedes acceder al objeto de configuraci贸n con todas sus propiedades.


	拆拆梆 梆火别  筐/梆娥拆筐筐  梆拣桂桂金桂:
	Desde window.customCollapseSections.addCollapseListener, puedes agregar un oyente que se ejecutar谩 cuando el colapsable elegido se abra o cierre.


	娥桂拣 金拆筐拣火桂娥别拣 金筐 梆火别 拆 娥拆筐/梆拆筐筐别 拆 梆拣桂桂金桂:
	A cada elemento activador y al elemento colapsable se le agrega el atributo "collapse-open", que determina si el colapsable est谩 abierto o no, con valores "true" o "false". 
	Esto es 煤til, por ejemplo, para aplicar estilos al elemento seg煤n su estado. Para ello:

	1. Selecciona el elemento al que quieres aplicarle los estilos.
	2. Ve a la pesta帽a de "avanzado", y a abre la seccion "CSS personalizado". 
	3. Agrega el estilo CSS segun el atributo.
		Si quieres que solo aplique cuando esta abierto debe ser "[collapse-open=true]" y si quieres que solo aplique cuando esta cerrado "[collapse-open=false]"), por ejemplo:

	 selector[collapse-open=true] .arrow {
			transform: rotate(90deg);
	 }

	 
	 
	 
	 
*/
	
	
	
    document.addEventListener('DOMContentLoaded', function() {
        var CONFIG_COLLAPSE_SECTIONS = {
            transitionTime: 1000,
            atributtesName: {
                collapseSectionName: 'collapse-section-name',
                openCollapseSection: 'open-collapse-section',
                collapseSectionTransition: 'collapse-section-transition',
                collapseOpen: 'collapse-open'
            }
        };
        
        var collapse_sections = document.querySelectorAll(`[${CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseSectionName}]`) || [];
        
        collapse_sections.forEach(section => {
            try {
                var innerContent = document.createElement('div');
                innerContent.classList.add("collapse_section_container");
                innerContent.style.overflow = 'hidden';

                while (section.firstChild) {
                    innerContent.appendChild(section.firstChild);
                }
                section.appendChild(innerContent);

                section.style.maxHeight = '0';
                section.style.overflow = 'hidden';

                var triggerName = section.getAttribute(CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseSectionName);
                var trigger = document.querySelector(`[${CONFIG_COLLAPSE_SECTIONS.atributtesName.openCollapseSection}="${triggerName}"]`);
                
                if (trigger) {
                    trigger.onclick = (e) => {
                        e.preventDefault();
                        toggleCollapse(triggerName);
                    };

                    var internalLinks = trigger.querySelectorAll('a');
                    internalLinks.forEach(link => {
                        link.onclick = (e) => {
                            e.preventDefault();
                        };
                    });
                }
            } catch (error) {
                console.error("Error al procesar las secciones de colapso:", error);
            }
        });

        function toggleCollapse(triggerName, action) {
            try {
                var section = document.querySelector(`[${CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseSectionName}="${triggerName}"]`);
                var trigger = document.querySelector(`[${CONFIG_COLLAPSE_SECTIONS.atributtesName.openCollapseSection}="${triggerName}"]`);
                
                if (!section || !trigger) return;

                var innerContent = section.querySelector('div.collapse_section_container');
                if (!innerContent) return;

                var isOpen = section.getAttribute(CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseOpen) === 'true';
                var transitionTime = Number(section.getAttribute(CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseSectionTransition)) || CONFIG_COLLAPSE_SECTIONS.transitionTime;

                section.style.transition = `max-height ${transitionTime}ms ease`;
                section.style.overflow = 'hidden';

                var computedStyle = getComputedStyle(section);
                var padding = parseFloat(computedStyle.paddingTop) + parseFloat(computedStyle.paddingBottom);
                var margin = parseFloat(computedStyle.marginTop) + parseFloat(computedStyle.marginBottom);
                
                const toggleAttrCollapseOpen = (value) => {
                    section.setAttribute(CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseOpen, value);
                    trigger.setAttribute(CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseOpen, value);
                };
                
                const setSectionMaxHeight = () => {
                    section.style.maxHeight = `${innerContent.scrollHeight + padding + margin}px`;
                };

                const dispatchCollapseEvent = (isOpened) => {
                    const event = new CustomEvent('collapseToggle', {
                        detail: {
                            triggerName: triggerName,
                            isOpen: isOpened
                        }
                    });
                    section.dispatchEvent(event);
                };

                if (action === 'close' || (action === undefined && isOpen)) {
                    setSectionMaxHeight();
                    requestAnimationFrame(() => {
                        section.style.maxHeight = '0';
                    });
                    toggleAttrCollapseOpen('false');
                    dispatchCollapseEvent(false);
                } else if (action === 'open' || (action === undefined && !isOpen)) {
                    setSectionMaxHeight();
                    toggleAttrCollapseOpen('true');
                    
                    setTimeout(() => {
                        section.style.maxHeight = '';
                    }, transitionTime);
                    dispatchCollapseEvent(true);
                }
            } catch (error) {
                console.error(`Error al alternar el colapso de la secci贸n '${triggerName}':`, error);
            }
        }

        window.customCollapseSections = {
            config: CONFIG_COLLAPSE_SECTIONS,
            open: (triggerName) => {
                try {
                    toggleCollapse(triggerName, 'open');
                } catch (error) {
                    console.error(`Error al abrir la secci贸n '${triggerName}':`, error);
                }
            },
            close: (triggerName) => {
                try {
                    toggleCollapse(triggerName, 'close');
                } catch (error) {
                    console.error(`Error al cerrar la secci贸n '${triggerName}':`, error);
                }
            },
            toggle: (triggerName) => {
                try {
                    toggleCollapse(triggerName);
                } catch (error) {
                    console.error(`Error al alternar la secci贸n '${triggerName}':`, error);
                }
            },
            addCollapseListener: (triggerName, callback) => {
                const section = document.querySelector(`[${CONFIG_COLLAPSE_SECTIONS.atributtesName.collapseSectionName}="${triggerName}"]`);
                if (section) {
                    section.addEventListener('collapseToggle', callback);
                }
            }
        };
    });
</script>
